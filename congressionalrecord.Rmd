---
title: "congressionalrecord"
author: "Max Weiss"
date: "9/29/2019"
output: html_document
---

```{r setup, include=FALSE}

library(tidyverse)

```


```{r blue, include=FALSE}

text <- read_csv("congress_test.csv", col_names = FALSE) %>%
  mutate_if(is.character, replace_na, replace = "") %>%
  mutate(list = paste(X1, X2, X3, X4, X5)) %>%
  select(list)

paste(unlist(text), collapse = "")

```


```{r mauve}
#114
speech114 <- read.table("hein-daily/speeches_114.txt", sep = "|", fill = TRUE, header = TRUE) %>%
  mutate(speech_id = as.factor(speech_id))

descr114 <- read.table("hein-daily/descr_114.txt", sep = "|", fill = TRUE, header = TRUE) %>%
  mutate(speech_id = as.factor(speech_id))

big_114 <- left_join(descr114, speech114, by = "speech_id")

opioid_114 <- big_114 %>%
  filter(str_detect(speech, regex("Heroin|Opioid|opiate|fentanyl", 
                                  ignore_case = TRUE)))

nrow(opioid_114)
nrow(big_114)

#113
speech113 <- read.table("hein-daily/speeches_113.txt", sep = "|", fill = TRUE, header = TRUE) %>%
  mutate(speech_id = as.factor(speech_id))

descr113 <- read.table("hein-daily/descr_113.txt", sep = "|", fill = TRUE, header = TRUE) %>%
  mutate(speech_id = as.factor(speech_id))

big_113 <- left_join(descr113, speech113, by = "speech_id")

opioid_113 <- big_113 %>%
  filter(str_detect(speech, regex("Heroin|Opioid|opiate|fentanyl", 
                                  ignore_case = TRUE)))

nrow(opioid_113)
nrow(big_113)

#112
speech112 <- read.table("hein-daily/speeches_112.txt", sep = "|", fill = TRUE, header = TRUE) %>%
  mutate(speech_id = as.factor(speech_id))

descr112 <- read.table("hein-daily/descr_112.txt", sep = "|", fill = TRUE, header = TRUE) %>%
  mutate(speech_id = as.factor(speech_id))

big_112 <- left_join(descr112, speech112, by = "speech_id")

opioid_112 <- big_112 %>%
  filter(str_detect(speech, regex("Heroin|Opioid|opiate|fentanyl", 
                                  ignore_case = TRUE)))

nrow(opioid_112)
nrow(big_112)

#111
speech111 <- read.table("hein-daily/speeches_111.txt", sep = "|", fill = TRUE, header = TRUE) %>%
  mutate(speech_id = as.factor(speech_id))

descr111 <- read.table("hein-daily/descr_111.txt", sep = "|", fill = TRUE, header = TRUE) %>%
  mutate(speech_id = as.factor(speech_id))

big_111 <- left_join(descr111, speech111, by = "speech_id")

opioid_111 <- big_111 %>%
  filter(str_detect(speech, regex("Heroin|Opioid|opiate|fentanyl", 
                                  ignore_case = TRUE)))

nrow(opioid_111)
nrow(big_111)

#110
speech110 <- read.table("hein-daily/speeches_110.txt", sep = "|", fill = TRUE, header = TRUE) %>%
  mutate(speech_id = as.factor(speech_id))

descr110 <- read.table("hein-daily/descr_110.txt", sep = "|", fill = TRUE, header = TRUE) %>%
  mutate(speech_id = as.factor(speech_id))

big_110 <- left_join(descr110, speech110, by = "speech_id")

opioid_110 <- big_110 %>%
  filter(str_detect(speech, regex("Heroin|Opioid|opiate|fentanyl", 
                                  ignore_case = TRUE)))

nrow(opioid_110)
nrow(big_110)

#109
speech109 <- read.table("hein-daily/speeches_109.txt", sep = "|", fill = TRUE, header = TRUE) %>%
  mutate(speech_id = as.factor(speech_id))

descr109 <- read.table("hein-daily/descr_109.txt", sep = "|", fill = TRUE, header = TRUE) %>%
  mutate(speech_id = as.factor(speech_id))

big_109 <- left_join(descr109, speech109, by = "speech_id")

opioid_109 <- big_109 %>%
  filter(str_detect(speech, regex("Heroin|Opioid|opiate|fentanyl", 
                                  ignore_case = TRUE)))

nrow(opioid_109)
nrow(big_109)

#108
speech108 <- read.table("hein-daily/speeches_108.txt", sep = "|", fill = TRUE, header = TRUE) %>%
  mutate(speech_id = as.factor(speech_id))

descr108 <- read.table("hein-daily/descr_108.txt", sep = "|", fill = TRUE, header = TRUE) %>%
  mutate(speech_id = as.factor(speech_id))

big_108 <- left_join(descr108, speech108, by = "speech_id")

opioid_108 <- big_108 %>%
  filter(str_detect(speech, regex("Heroin|Opioid|opiate|fentanyl", 
                                  ignore_case = TRUE)))

nrow(opioid_108)
nrow(big_108)

#107
speech107 <- read.table("hein-daily/speeches_107.txt", sep = "|", fill = TRUE, header = TRUE) %>%
  mutate(speech_id = as.factor(speech_id))

descr107 <- read.table("hein-daily/descr_107.txt", sep = "|", fill = TRUE, header = TRUE) %>%
  mutate(speech_id = as.factor(speech_id))

big_107 <- left_join(descr107, speech107, by = "speech_id")

opioid_107 <- big_107 %>%
  filter(str_detect(speech, regex("Heroin|Opioid|opiate|fentanyl", 
                                  ignore_case = TRUE)))

nrow(opioid_107)
nrow(big_107)

#106
speech106 <- read.table("hein-daily/speeches_106.txt", sep = "|", fill = TRUE, header = TRUE) %>%
  mutate(speech_id = as.factor(speech_id))

descr106 <- read.table("hein-daily/descr_106.txt", sep = "|", fill = TRUE, header = TRUE) %>%
  mutate(speech_id = as.factor(speech_id))

big_106 <- left_join(descr106, speech106, by = "speech_id")

opioid_106 <- big_106 %>%
  filter(str_detect(speech, regex("Heroin|Opioid|opiate|fentanyl", 
                                  ignore_case = TRUE)))

nrow(opioid_106)
nrow(big_106)

#105
speech105 <- read.table("hein-daily/speeches_105.txt", sep = "|", fill = TRUE, header = TRUE) %>%
  mutate(speech_id = as.factor(speech_id))

descr105 <- read.table("hein-daily/descr_105.txt", sep = "|", fill = TRUE, header = TRUE) %>%
  mutate(speech_id = as.factor(speech_id))

big_105 <- left_join(descr105, speech105, by = "speech_id")

opioid_105 <- big_105 %>%
  filter(str_detect(speech, regex("Heroin|Opioid|opiate|fentanyl", 
                                  ignore_case = TRUE)))

nrow(opioid_105)
nrow(big_105)

#104
speech104 <- read.table("hein-daily/speeches_104.txt", sep = "|", fill = TRUE, header = TRUE) %>%
  mutate(speech_id = as.factor(speech_id))

descr104 <- read.table("hein-daily/descr_104.txt", sep = "|", fill = TRUE, header = TRUE) %>%
  mutate(speech_id = as.factor(speech_id))

big_104 <- left_join(descr104, speech104, by = "speech_id")

opioid_104 <- big_104 %>%
  filter(str_detect(speech, regex("Heroin|Opioid|opiate|fentanyl", 
                                  ignore_case = TRUE)))

nrow(opioid_104)
nrow(big_104)

#103
speech103 <- read.table("hein-daily/speeches_103.txt", sep = "|", fill = TRUE, header = TRUE) %>%
  mutate(speech_id = as.factor(speech_id))

descr103 <- read.table("hein-daily/descr_103.txt", sep = "|", fill = TRUE, header = TRUE) %>%
  mutate(speech_id = as.factor(speech_id))

big_103 <- left_join(descr103, speech103, by = "speech_id")

opioid_103 <- big_103 %>%
  filter(str_detect(speech, regex("Heroin|Opioid|opiate|fentanyl", 
                                  ignore_case = TRUE)))

nrow(opioid_103)
nrow(big_103)

#102
speech102 <- read.table("hein-daily/speeches_102.txt", sep = "|", fill = TRUE, header = TRUE) %>%
  mutate(speech_id = as.factor(speech_id))

descr102 <- read.table("hein-daily/descr_102.txt", sep = "|", fill = TRUE, header = TRUE) %>%
  mutate(speech_id = as.factor(speech_id))

big_102 <- left_join(descr102, speech102, by = "speech_id")

opioid_102 <- big_102 %>%
  filter(str_detect(speech, regex("Heroin|Opioid|opiate|fentanyl", 
                                  ignore_case = TRUE)))

nrow(opioid_102)
nrow(big_102)

```

```{r freq viz}

fent_102 <- opioid_102 %>%
  filter(str_detect(speech, regex("fentanyl", 
                                  ignore_case = TRUE)))
fent_103 <- opioid_103 %>%
  filter(str_detect(speech, regex("fentanyl", 
                                  ignore_case = TRUE)))
fent_104 <- opioid_104 %>%
  filter(str_detect(speech, regex("fentanyl", 
                                  ignore_case = TRUE)))
fent_105 <- opioid_105 %>%
  filter(str_detect(speech, regex("fentanyl", 
                                  ignore_case = TRUE)))
fent_106 <- opioid_106 %>%
  filter(str_detect(speech, regex("fentanyl", 
                                  ignore_case = TRUE)))
fent_107 <- opioid_107 %>%
  filter(str_detect(speech, regex("fentanyl", 
                                  ignore_case = TRUE)))
fent_108 <- opioid_108 %>%
  filter(str_detect(speech, regex("fentanyl", 
                                  ignore_case = TRUE)))
fent_109 <- opioid_109 %>%
  filter(str_detect(speech, regex("fentanyl", 
                                  ignore_case = TRUE)))
fent_110 <- opioid_110 %>%
  filter(str_detect(speech, regex("fentanyl", 
                                  ignore_case = TRUE)))
fent_111 <- opioid_111 %>%
  filter(str_detect(speech, regex("fentanyl", 
                                  ignore_case = TRUE)))
fent_112 <- opioid_112 %>%
  filter(str_detect(speech, regex("fentanyl", 
                                  ignore_case = TRUE)))
fent_113 <- opioid_113 %>%
  filter(str_detect(speech, regex("fentanyl", 
                                  ignore_case = TRUE)))
fent_114 <- opioid_114 %>%
  filter(str_detect(speech, regex("fentanyl", 
                                  ignore_case = TRUE)))

freq <- tibble(session = c(102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114), 
               opioid = c(nrow(opioid_102), nrow(opioid_103), nrow(opioid_104), nrow(opioid_105), nrow(opioid_106), nrow(opioid_107), nrow(opioid_108), nrow(opioid_109), nrow(opioid_110), nrow(opioid_111), nrow(opioid_112), nrow(opioid_113), nrow(opioid_114)),
               fent = c(nrow(fent_102), nrow(fent_103), nrow(fent_104), nrow(fent_105), nrow(fent_106), nrow(fent_107), nrow(fent_108), nrow(fent_109), nrow(fent_110), nrow(fent_111), nrow(fent_112), nrow(fent_113), nrow(fent_114)),
               total = c(nrow(big_102), nrow(big_103), nrow(big_104), nrow(big_105), nrow(big_106), nrow(big_107), nrow(big_108), nrow(big_109), nrow(big_110), nrow(big_111), nrow(big_112), nrow(big_113), nrow(big_114))) %>%
  mutate(opioid_freq = opioid / total,
         fent_freq = fent / total,
         fent_op = fent / opioid)

freq %>% ggplot(aes(x = session, y = opioid_freq)) +
  geom_col(fill = "darkblue")
  
freq %>% ggplot(aes(x = session, y = fent_freq)) +
  geom_col(fill = "darkblue")

freq %>% ggplot(aes(x = session, y = fent_op)) +
  geom_col(fill = "darkblue")
```





